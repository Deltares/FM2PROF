<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>Troubleshooting &#8212; FM2PROF 1.4.4 documentation</title>

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/material-icons.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images\LightBox2\lightbox2\dist\css\lightbox.css" />
    <link rel="stylesheet" href="../../_static/notosanscjkjp.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/roboto.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/material-design-lite-1.3.0/material.indigo-blue.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_materialdesign_theme.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinxcontrib-images\LightBox2\lightbox2\dist\js\lightbox-plus-jquery.min.js"></script>
    <script src="../../_static/sphinxcontrib-images\LightBox2\lightbox2-customize\jquery-noconflict.js"></script>
    <script src="../../_static/sphinx_materialdesign_theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="API" href="source.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" /> 
  </head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer"><header class="mdl-layout__header mdl-layout__header--waterfall ">
    <div class="mdl-layout__header-row">
        
        <nav class="mdl-navigation breadcrumb">
            <a class="mdl-navigation__link" href="index.html">User Manual</a><i class="material-icons">navigate_next</i>
            <a class="mdl-navigation__link is-active">Troubleshooting</a>
        </nav>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
        
<form class="form-inline pull-sm-right" action="../../search.html" method="get">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
        <label id="quick-search-icon" class="mdl-button mdl-js-button mdl-button--icon"  for="waterfall-exp">
            <i class="material-icons">search</i>
        </label>
        <div class="mdl-textfield__expandable-holder">
          <input class="mdl-textfield__input" type="text" name="q"  id="waterfall-exp" placeholder="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </div>
      </div>
      <div class="mdl-tooltip" data-mdl-for="quick-search-icon">
      Quick search
      </div>
</form>
        
<a id="button-show-source"
    class="mdl-button mdl-js-button mdl-button--icon"
    href="../../_sources/chapters/user_manual/advanced.rst.txt" rel="nofollow">
<i class="material-icons">code</i>
</a>
<div class="mdl-tooltip" data-mdl-for="button-show-source">
Show Source
</div>
        </nav>
    </div>
    <div class="mdl-layout__header-row header-links">
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation">
          <a  class="mdl-navigation__link" href="../../index.html">
                  <i class="material-icons navigation-link-icon">home</i>
                  Home
              </a>
          
              <a  class="mdl-navigation__link" href="https://deltares.nl">
                  <i class="material-icons navigation-link-icon">launch</i>
                  Deltares
              </a>
      </nav>
    </div>
</header><header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../../index.html">
              <img class="logo" src="../../_static/logo_deltares.png" alt="FM2PROF"/>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="source.html">API</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>
        <main class="mdl-layout__content" tabIndex="0">
<header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../../index.html">
              <img class="logo" src="../../_static/logo_deltares.png" alt="FM2PROF"/>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="source.html">API</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>

    <div class="document">
        <div class="page-content">
        
  <section id="troubleshooting">
<span id="diagnosis"></span><h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>After running FM2PROF, it is important to check its output. In this section we provide some steps to diagnose and interprete your model results. In short, the steps are the following:</p>
<ol class="arabic simple">
<li><p>Check the log for errors &amp; warnings</p></li>
<li><p>Visualising output</p></li>
<li><p>Comparing model results</p></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>FM2PROF output consists of:</p>
<blockquote>
<div><ul class="simple">
<li><p>SOBEK 3 format files (<cite>geometry.csv</cite>, <cite>roughness.csv</cite>)</p></li>
<li><p>DFlow1D format files (<cite>CrossSectionLocations.ini</cite>, <cite>CrossSectionDefinitions.ini</cite>, etc. )</p></li>
<li><p>diagnosis files (<cite>fm2prof.log</cite>, <cite>volumes.csv</cite>, <cite>cross_section_volumes.geojson</cite>)</p></li>
<li><p>optional diagnosis files (see the <cite>ExportMapFiles</cite> parameter)</p></li>
<li><p>the log file (fm2prof.log)</p></li>
</ul>
</div></blockquote>
</div>
<section id="checking-the-log">
<h2>1. Checking the log<a class="headerlink" href="#checking-the-log" title="Permalink to this headline">¶</a></h2>
<p>FM2PROF logs to the console and to a file. By default, they do not show the same information: messages flagged as <cite>debug</cite> are not written to screen by default (but they are to file). The log is written to the output directory as <cite>fm2prof.log</cite> by default. The log first prints the configuration used during the run. You can use this to reproduce your results later one.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>It is good practice to open the log and <cite>Ctrl-F</cite> search for warnings and errors. Warnings alert the user on possible input error (e.g. overlapping polygons), but that do not prevent execution of the problem, and may even not affect the output adversely. Errors should not be ignored, but resolved.</p>
</div>
<p>In general, the log consists of the following sections:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>2020-07-23 15:55    INFO    0% T+ 0.04s Opening FM Map file
2020-07-23 15:55    INFO    0% T+ 0.28s Closed FM Map file
2020-07-23 15:55    INFO    0% T+ 0.28s Opening css file
2020-07-23 15:55    INFO    0% T+ 0.28s Closed css file
2020-07-23 15:55    INFO    0% T+ 0.28s All 2D points assigned to the same region and classifying points to cross-sections
2020-07-23 15:55    INFO    0% T+ 0.34s Assigning point to sections without polygons
2020-07-23 15:55    INFO    0% T+ 0.35s finished reading FM and cross-sectional data data
2020-07-23 15:55   DEBUG    0% T+ 0.35s Number of: timesteps (169), faces (360), edges (654)
</pre></div>
</div>
<p>If FM2PROF fails in this section, the initialisation or files may not be loaded properly. This phase may take some minutes for large models, especially if regions and sections are used.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The number of faces and edges corresponds to the 2D grid cells. They greatly determines the initialisation time. For example, the initialisation step for the Meuse model (face count: 353,882) take about 60-70 seconds.</p>
<p>The number of timesteps determines the time for each cross-section to be derived (next section).</p>
</div>
<p>Next, the program will loop through all the cross-sections. A single iteration may look like this (debug information is cropped out):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>2020-07-23 15:55    INFO    0% T+ 0.36s Starting new task: case1_0
2020-07-23 15:55    INFO    0% T+ 0.66s Initiated new cross-section
2020-07-23 15:55    INFO    0% T+ 0.87s Retrieving centre point values
2020-07-23 15:55    INFO    0% T+ 0.88s Identifying lakes
2020-07-23 15:55    INFO    0% T+ 1.49s Seperating flow from storage
2020-07-23 15:55    INFO    0% T+ 2.04s Computing cross-section from water levels
2020-07-23 15:55    INFO    0% T+ 2.04s Computing cross-section from bed levels
2020-07-23 15:55    INFO    0% T+ 2.07s correction finished
2020-07-23 15:55    INFO    0% T+ 2.07s Cross-section reduced from 173 to 20 points
2020-07-23 15:55    INFO    0% T+ 2.08s Computed roughness
2020-07-23 15:55    INFO    0% T+ 2.08s Cross-section case1_0 derived in 1.73 s
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If each cross-section takes a long time to derive, the number of output timesteps in your 2D model may be too large. Each cross-section in the Meuse model take &lt; 2 second to be derived.</p>
</div>
<p>Finally the program will finish:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>2020-06-05 08:04    INFO    0% T+ 692.61s Starting new task: Finalizing
2020-06-05 08:04    INFO    0% T+ 692.61s Interpolating roughness
2020-06-05 08:04    INFO    0% T+ 692.68s Export model input files to ../Maas_dir/Output/maas_default_settings\test19
2020-06-05 08:04    INFO    0% T+ 698.96s Exported output files, FM2PROF finished
2020-06-05 08:04    INFO    0% T+ 698.97s Export geojson output to ../Maas_dir/Output/maas_default_settings\test19
2020-06-05 08:04   DEBUG    0% T+ 698.99s Collected points, dumping to file
2020-06-05 08:04   DEBUG    0% T+ 729.79s Done
2020-06-05 08:04   DEBUG    0% T+ 729.86s Collected points, dumping to file
2020-06-05 08:05   DEBUG    0% T+ 773.85s Done
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The Meuse pilot model take about 13 minutes to produce 1D input.</p>
</div>
</section>
<section id="visualising-output">
<h2>2. Visualising output<a class="headerlink" href="#visualising-output" title="Permalink to this headline">¶</a></h2>
<p>There are various ways to visualise FM2PROF output.</p>
<section id="with-utils-visualiseoutput">
<h3>With utils.VisualiseOutput<a class="headerlink" href="#with-utils-visualiseoutput" title="Permalink to this headline">¶</a></h3>
<p>First, the <cite>fm2prof.utils</cite> module provides a class to directly load and visualise the output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fm2prof</span> <span class="kn">import</span> <span class="n">utils</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;tests\Output\RunWithFiles_Output\case_05_dyke\CaseName01&#39;</span>

<span class="n">viz</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">VisualiseOutput</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

<span class="k">for</span> <span class="n">css</span> <span class="ow">in</span> <span class="n">viz</span><span class="o">.</span><span class="n">cross_sections</span><span class="p">():</span>
    <span class="c1"># This creates a directory &#39;figures&#39; in output_dir</span>
    <span class="n">viz</span><span class="o">.</span><span class="n">make_figure</span><span class="p">(</span><span class="n">css</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces figures in the output directory.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/interprete_figure.png"><img alt="alternate text" src="../../_images/interprete_figure.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Example interpretation of a ` fm2prof.utils.VisualiseOutput`  figure for testcase <a class="reference internal" href="../technical_manual/validation.html#validation-summerdike"><span class="std std-ref">05 - Summer dike</span></a>.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The shape of the volume graph depends on the shape of the geometry:</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/volume_graphs_types.png"><img alt="alternate text" src="../../_images/volume_graphs_types.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">The shape of the volume graph for given geometries</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>For most real-world rivers, the volume graphs will follow a compound ‘trapezoidal’ model, with one or several ‘compartimentalisation’ effects.</p>
</section>
<section id="with-gis-software">
<h3>With GIS software<a class="headerlink" href="#with-gis-software" title="Permalink to this headline">¶</a></h3>
<p>A second way to visualise is with GIS software (such as QGIS). By default two files can be readily loaded in GIS software: the cross-section input file (which is a text delimited format) and the <cite>cross_section_volumes.geojson</cite> file. The latter is a convex-hull approximation of the control volumes (see <span class="xref std std-ref">terminology</span>).</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/gis_visualisation_maas_01.png"><img alt="alternate text" src="../../_images/gis_visualisation_maas_01.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Visualisation of the cross-section location (input) file and the convex-hull approximation of the control volumes (cross_section_volumes.geojson). The overlap of the polygons follows from the convex hull approximation - overlap is not actually possible.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Closer inspection is possible by setting <cite>ExportMapFiles</cite> to <cite>True</cite> in the configuration file. Note that this an create really large files.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For inspecting one or just a few cross-sections, use the <cite>CssSelection</cite> parameter to limit the output.</p>
</div>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/gis_visualisation_maas_02.png"><img alt="alternate text" src="../../_images/gis_visualisation_maas_02.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Visualisation of the actual assignment of 2D points to cross-sections using nearest-neighbour approximation. (note: region polygons were used here)</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../../_images/gis_visualisation_maas_03.png"><img alt="alternate text" src="../../_images/gis_visualisation_maas_03.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Visualisation of the (automatically classified) <span class="xref std std-term">lakes</span>. Be aware of the specific definition of ‘lake’. Water bodies that are hydraulically connected to the main channel at low water depths are not flagged as ‘lake’.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="../../_images/gis_visualisation_maas_04.png"><img alt="alternate text" src="../../_images/gis_visualisation_maas_04.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Visualisation of the roughness section. The red dots are 2D points that were not within any polygon in the <cite>SectionPolygonFile</cite>. These are automatically added to the main section. This will yield a warning in the log file. In general it is a good idea to expand the polygons to cover all files.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
</section>


        </div>
        <div class="side-doc-outline">
            <div class="side-doc-outline--content"> 
<div class="localtoc">
    <p class="caption">
      <span class="caption-text">Table Of Contents</span>
    </p>
    <ul>
<li><a class="reference internal" href="#">Troubleshooting</a><ul>
<li><a class="reference internal" href="#checking-the-log">1. Checking the log</a></li>
<li><a class="reference internal" href="#visualising-output">2. Visualising output</a><ul>
<li><a class="reference internal" href="#with-utils-visualiseoutput">With utils.VisualiseOutput</a></li>
<li><a class="reference internal" href="#with-gis-software">With GIS software</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
            </div>
        </div>

      <div class="clearer"></div>
    </div><div class="pagenation">
     <a id="button-prev" href="quickstart.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="P">
         <i class="pagenation-arrow-L material-icons">arrow_back</i>
         <div class="pagenation-text">
            <span class="pagenation-direction">Previous</span>
            <div>Quickstart</div>
         </div>
     </a>
     <a id="button-next" href="source.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="N">
        <i class="pagenation-arrow-R material-icons">arrow_forward</i>
        <div class="pagenation-text">
            <span class="pagenation-direction">Next</span>
            <div>API</div>
        </div>
     </a>
  </div>
        <footer class="mdl-mini-footer">
    <div class="mdl-mini-footer__left-section">
      <div class="mdl-logo">FM2PROF</div>
      <div>
        
        <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a></li>
</ul>

      </div>
    </div>

    <div class="mdl-mini-footer__right-section">
        <div>&copy; Copyright 2020, Deltares.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 4.3.1 using <a href="https://github.com/myyasuda/sphinx_materialdesign_theme">sphinx_materialdesign_theme</a>.</div>
    </div>
</footer>
        </main>
    </div>
  </body>
</html>